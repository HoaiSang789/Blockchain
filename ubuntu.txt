V√†o m√°y ·∫£o truy c·∫≠p ƒë·ªÉ l√†m b√†i 
https://github.com/HoaiSang789/Blockchain
T√¨m code.txt ƒë·ªÉ l√†m b√†i 

C√†i ƒë·∫∑t m√¥i tr∆∞·ªùng v√† x√¢y d·ª±ng h·ªá th·ªëng m·∫°ng fabric-samples
C·∫≠p nh·∫≠t source.list
1.Truy c·∫≠p gg: t·∫£i source.list ubuntu 22.04
sudo nano /etc/apt/sources.list
deb http://archive.ubuntu.com/ubuntu/ jammy main restricted universe multiverse
# deb-src http://archive.ubuntu.com/ubuntu/ jammy main restricted universe multiverse


deb http://archive.ubuntu.com/ubuntu/ jammy-updates main restricted universe multiverse
# deb-src http://archive.ubuntu.com/ubuntu/ jammy-updates main restricted universe multiverse


deb http://archive.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse
# deb-src http://archive.ubuntu.com/ubuntu/ jammy-security main restricted universe multiverse


deb http://archive.ubuntu.com/ubuntu/ jammy-backports main restricted universe multiverse
# deb-src http://archive.ubuntu.com/ubuntu/ jammy-backports main restricted universe multiverse


deb http://archive.canonical.com/ubuntu/ jammy partner
# deb-src http://archive.canonical.com/ubuntu/ jammy partner


Uninstall: 
sudo apt-get purge nodejs &&\ 
rm -r /etc/apt/sources.list.d/nodesource.list &&\ 
rm -r /etc/apt/keyrings/nodesource.gpg
sudo apt-get remove --purge nodejs libnode-dev 
sudo apt-get autoremove 
sudo apt-get clean 

2.Install: 
sudo apt update 
sudo apt upgrade 
sudo apt install -y curl 
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt install -y nodejs

sudo apt-get update 
sudo apt-get install git -y 
sudo apt-get install docker-compose -y
sudo systemctl start docker 
sudo systemctl enable docker 
sudo apt install jq -y

3.T·∫£i g√≥i c√†i ƒë·∫∑t Fabric Sample: 2.5.0 1.5.6 
curl -sSL https://bit.ly/2ysbOFE | bash -s -- 2.5.0 1.5.6 
4.Th√™m quy·ªÅn ng∆∞·ªùi d√πng v√†o group 
sudo usermod -aG docker $USER
reboot 
docker run hello-world

5.C√†i ƒë·∫∑t g√≥i npm 
sudo apt-get update 
sudo npm install npm@6.14.17 -g 
T·∫£i v√† c√†i ƒë·∫∑t ng√¥n ng·ªØ GO 
Ki·ªÉm tra v√† g·ª° c√°c phi√™n b·∫£n c≈© n·∫øu ƒë√£ c√†i ƒë·∫∑t:
 sudo rm -rf /usr/local/go 
Truy c·∫≠p: https://go.dev/dl/ 
T·∫£i b·∫£n 1.23.2 c√†i ƒë·∫∑t c·ªßa go v·ªÅ m√°y
Ch√©p v√†o th∆∞ m·ª•c /usr/local/ 
sudo tar -C /usr/local -xzf go1.23.2.linux-amd64.tar.gz
go version
6.C·∫≠p nh·∫≠t bi·∫øn m√¥i tr∆∞·ªùng v√†o th∆∞ m·ª•c go 
sudo nano ~/.bashrc
export PATH=$PATH:/home/ubuntu/.local/bin 
export GOROOT=/usr/local/go 
export PATH=$GOROOT/bin:$PATH 

export FABRIC_CFG_PATH=$HOME/fabric-samples/config/ 
export CORE_PEER_LOCALMSPID="Org1MSP" 
export CORE_PEER_MSPCONFIGPATH=$HOME/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/users/Admin@org1.example.com/msp 

export CORE_PEER_ADDRESS=localhost:7051
export CORE_PEER_TLS_ROOTCERT_FILE=$HOME/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt 
export CORE_PEER_TLS_ENABLED=true
#c·∫≠p nh·∫≠t file :
source ~/.bashrc
7.Kh·ªüi ƒë·ªông m·∫°ng Fabric v√† tri·ªÉn khai h·ª£p ƒë·ªìng th√¥ng minh 
Remove t·∫•t c·∫£ c√°c t√†i nguy√™n ƒë√£ c√≥ ƒë·ªÉ t·∫°o c√°c t√†i nguy√™n m·ªõi (tr√°nh 2 ·ª©ng d·ª•ng kh√°c nhau c√πng chia s·∫ª c√πng m·ªôt t√†i nguy√™n) 
cd fabric-samples/test-network
./network.sh down

8.Ch·∫°y script network.sh ƒë·ªÉ kh·ªüi t·∫°o v√† ch·∫°y m·∫°ng Fabric cho ·ª©ng d·ª•ng:
./network.sh up createChannel -ca -s couchdb

9.Sau khi m·∫°ng ƒë√£ kh·ªüi ƒë·ªông, b·∫°n c√≥ th·ªÉ tri·ªÉn khai h·ª£p ƒë·ªìng th√¥ng minh ( chaincode ) cho asset-transfer-basic: 
./network.sh deployCC -ccn basic -ccp /home/ubuntu/fabric-samples/asset-transfer-basic/chaincode-go -ccl go

10.Tr∆∞·ªùng h·ª£p g·∫∑p l·ªói sau ƒë√¢y c·∫ßn c√†i ƒë·∫∑t th√™m module c·∫ßn thi·∫øt cho d·ª± √°n 
cd ~/fabric-samples/asset-transfer-basic/application-gateway-javascript/src
npm install @grpc/grpc-js 
npm install @hyperledger/fabric-gateway 

11.Ch·∫°y l·ªánh t·∫°o t√†i s·∫£n m·ªõi tr√™n th∆∞ m·ª•c asset-transfer-basic 
fit@fit-virtual-machine:~/fabric-samples/asset-transfer-basic/application-gat eway-javascript/src$ node app.js

12.C√†i ƒë·∫∑t peer ƒë·ªÉ th·ª±c hi·ªán thao t√°c tr√™n network 
npm install --save-dev --ignore-scripts install-peers 
#Them peer vao bashrc 
cd ~/fabric-samples/bin 
export PATH=$PATH:$PWD
# Ki·ªÉm tra peer: 
peer version

13.Th√™m t√†i s·∫£n: 
C·∫ßn x√°c ƒë·ªãnh c√≥ bao nhi√™u t·ªï ch·ª©c x√°c nh·∫≠n tr√™n h·ªá th·ªëng hi·ªán t·∫°i: 
peer lifecycle chaincode querycommitted --channelID mychannel --name basic 

14.·ªû ƒë√¢y c·∫ßn 2 t·ªï ch·ª©c ch·∫•p nh·∫≠n ƒë·ªÉ c√≥ th·ªÉ th√™m 1 t√†i s·∫£n m·ªõi
peer chaincode invoke -o 127.0.0.1:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C mychannel -n basic --peerAddresses localhost:7051 --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses localhost:9051 --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{"Args":["CreateAsset","asset20","green","8","Sang","300"]}'

Ki·ªÉm tra t√†i s·∫£n v·ª´a th√™m: 
peer chaincode query -C mychannel -n basic -c '{"Args":["ReadAsset","asset20"]}'

CHAINCODE
1.Trong th∆∞ m·ª•c fabric-sample t·∫°o th∆∞ m·ª•c mychaincode
mkdir -p ~/fabric-samples/chaincode/mychaincode 
cd fabric-samples
2.T·∫°o file mychaincode.go trong th∆∞ m·ª•c fabric-samples/chaincode/mychaincode/ v·ªõi n·ªôi dung sau:
mychaincode.go
‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶.
package main

import (
    "fmt"
    "github.com/hyperledger/fabric-contract-api-go/contractapi"
)

// SmartContract ƒë·ªãnh nghƒ©a c·∫•u tr√∫c chaincode
type SmartContract struct {
    contractapi.Contract
}

// InitLedger kh·ªüi t·∫°o ledger v·ªõi d·ªØ li·ªáu m·∫´u
func (s *SmartContract) InitLedger(ctx contractapi.TransactionContextInterface) error {
    sampleData := map[string]string{
        "asset1": "value1",
        "asset2": "value2",
        "asset3": "value3",
    }

    for key, value := range sampleData {
        err := ctx.GetStub().PutState(key, []byte(value))
        if err != nil {
            return fmt.Errorf("L·ªói kh·ªüi t·∫°o ledger: %s", err.Error())
        }
    }
    return nil
}

// Set th√™m m·ªôt c·∫∑p key-value v√†o ledger
func (s *SmartContract) Set(ctx contractapi.TransactionContextInterface, key string, value string) error {
    if key == "" || value == "" {
        return fmt.Errorf("Key v√† value kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng")
    }
    return ctx.GetStub().PutState(key, []byte(value))
}

// Get l·∫•y gi√° tr·ªã c·ªßa m·ªôt key t·ª´ ledger
func (s *SmartContract) Get(ctx contractapi.TransactionContextInterface, key string) (string, error) {
    value, err := ctx.GetStub().GetState(key)
    if err != nil {
        return "", fmt.Errorf("Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu: %s", err.Error())
    }
    if value == nil {
        return "", fmt.Errorf("Key kh√¥ng t·ªìn t·∫°i")
    }
    return string(value), nil
}

// Update c·∫≠p nh·∫≠t gi√° tr·ªã m·ªõi cho m·ªôt key c√≥ s·∫µn
func (s *SmartContract) Update(ctx contractapi.TransactionContextInterface, key string, newValue string) error {
    exists, err := s.AssetExists(ctx, key)
    if err != nil {
        return err
    }
    if !exists {
        return fmt.Errorf("Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t: Key %s kh√¥ng t·ªìn t·∫°i", key)
    }
    return ctx.GetStub().PutState(key, []byte(newValue))
}

// Delete x√≥a m·ªôt key kh·ªèi ledger
func (s *SmartContract) Delete(ctx contractapi.TransactionContextInterface, key string) error {
    if key == "" {
        return fmt.Errorf("Key kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng")
    }
    exists, err := s.AssetExists(ctx, key)
    if err != nil {
        return err
    }
    if !exists {
        return fmt.Errorf("Kh√¥ng th·ªÉ x√≥a: Key %s kh√¥ng t·ªìn t·∫°i", key)
    }
    return ctx.GetStub().DelState(key)
}

// AssetExists ki·ªÉm tra xem key c√≥ t·ªìn t·∫°i trong ledger hay kh√¥ng
func (s *SmartContract) AssetExists(ctx contractapi.TransactionContextInterface, key string) (bool, error) {
    data, err := ctx.GetStub().GetState(key)
    if err != nil {
        return false, fmt.Errorf("Kh√¥ng th·ªÉ ki·ªÉm tra key: %s", err.Error())
    }
    return data != nil, nil
}

// H√†m main ƒë·ªÉ kh·ªüi ƒë·ªông chaincode
func main() {
    chaincode, err := contractapi.NewChaincode(new(SmartContract))
    if err != nil {
        fmt.Printf("L·ªói t·∫°o chaincode: %s", err.Error())
        return
    }

    if err := chaincode.Start(); err != nil {
        fmt.Printf("L·ªói kh·ªüi ƒë·ªông chaincode: %s", err.Error())
    }
}

‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶..

3.Di chuy·ªÉn v√†o th∆∞ m·ª•c mychaincode t·∫°o module
go mod init mychaincode 
4.Ch·∫°y l·ªánh sau ƒë·ªÉ t·∫£i v√† qu·∫£n l√Ω c√°c dependencies cho d·ª± √°n c·ªßa b·∫°n: 
go mod tidy

5.ƒê√≥ng g√≥i chaincode 
Sau khi ƒë√£ kh·ªüi t·∫°o go.mod v√† t·∫£i t·∫•t c·∫£ c√°c dependencies, quay l·∫°i th∆∞ m·ª•c testnetwork v√† th·ª≠ l·∫°i qu√° tr√¨nh ƒë√≥ng g√≥i chaincode. 
L·ªánh n√†y s·∫Ω t·∫°o file mychaincode.tar.gz cho chaincode c·ªßa b·∫°n.
peer lifecycle chaincode package mychaincode.tar.gz --path ~/fabric-samples/chaincode/mychaincode --lang golang --label mychaincode_1.0

 6.Ti·∫øp theo, c√†i ƒë·∫∑t chaincode l√™n peer nh∆∞ tr∆∞·ªõc ƒë√¢y: 
./network.sh up createChannel -c mychannel -ca 
peer lifecycle chaincode install mychaincode.tar.gz 

7.Deploy chaincode 
./network.sh deployCC -ccn mychaincode -ccp ../chaincode/mychaincode -ccl go

G·ªçi chaincode ƒë√£ tri·ªÉn khai L∆∞u √Ω: ch·∫Øc ch·∫Øn r·∫±ng d·ªØ li·ªáu ƒë∆∞·ª£c ƒë·ªìng b·ªô t·ªõi t·∫•t c·∫£ c√°c peer.)


//// L·ªánh Th√™m D·ªØ Li·ªáu
peer chaincode invoke \
  -o 127.0.0.1:7050 \
  --ordererTLSHostnameOverride orderer.example.com \
  --tls \
  --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
  -C mychannel \
  -n mychaincode \
  --peerAddresses localhost:7051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
  --peerAddresses localhost:9051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
  -c '{"Args":["Set","key1","value2"]}'










//// L·ªánh ki·ªÉm tra d·ªØ li·ªáu ƒë√£ t·∫°o 
L·∫•y gi√° tr·ªã c·ªßa key, value 
peer chaincode query -C mychannel -n mychaincode -c '{"Args":["Get","key 1"]}'

///// L·ªánh C·∫¨P NH·∫¨T d·ªØ li·ªáu
peer chaincode invoke \
  -o 127.0.0.1:7050 \
  --ordererTLSHostnameOverride orderer.example.com \
  --tls \
  --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
  -C mychannel \
  -n mychaincode \
  --peerAddresses localhost:7051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
  --peerAddresses localhost:9051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
  -c '{"Args":["Update","key1","new_value1"]}'



/// L·ªánh X√ìA d·ªØ li·ªáu
peer chaincode invoke \
  -o 127.0.0.1:7050 \
  --ordererTLSHostnameOverride orderer.example.com \
  --tls \
  --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
  -C mychannel \
  -n mychaincode \
  --peerAddresses localhost:7051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
  --peerAddresses localhost:9051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
  -c '{"Args":["Delete","key1"]}'


S·ª≠ d·ª•ng l·ªánh peer channel fetch ƒë·ªÉ xem block
peer channel fetch newest ./newest_block.block -o 127.0.0.1:7050 --ordererTLSHostnameOverride orderer.example.com --tls --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem -c mychannel

D√πng l·ªánh configtxlator ƒë·ªÉ gi·∫£i m√£ block 
configtxlator proto_decode --input newest_block.block --type common.Block --output newest_block.json 


Xem th√¥ng tin giao d·ªãch: cat newest_block.json

‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶.
package main

import (
	"encoding/json"
	"fmt"

	"github.com/hyperledger/fabric-contract-api-go/contractapi"
)

type SmartContract struct{ contractapi.Contract }

// M·ªói b·∫£n ghi l√† ƒëi·ªÉm c·ªßa 1 h·ªçc ph·∫ßn cho 1 MSSV
type Student struct {
	MaHP  string  `json:"ma_hp"`
	MSSV  string  `json:"mssv"`
	HoTen string  `json:"ho_ten"`
	DiemHP float64 `json:"diem_hp"`
}

// ----------------- Helpers -----------------
func makeKey(ctx contractapi.TransactionContextInterface, maHP, mssv string) (string, error) {
	return ctx.GetStub().CreateCompositeKey("grade", []string{maHP, mssv})
}

// ----------------- CRUD -----------------

// Th√™m sinh vi√™n/h·ªçc ph·∫ßn (1 b·∫£n ghi ƒëi·ªÉm)
func (s *SmartContract) AddStudent(ctx contractapi.TransactionContextInterface, maHP, mssv, hoTen string, diem float64) error {
	// Validate input
	if maHP == "" || mssv == "" || hoTen == "" {
		return fmt.Errorf("Thi·∫øu tham s·ªë: maHP, mssv, hoTen")
	}
	if diem < 0 || diem > 10 {
		return fmt.Errorf("ƒêi·ªÉm kh√¥ng h·ª£p l·ªá (0‚Äì10)")
	}

	key, err := makeKey(ctx, maHP, mssv)
	if err != nil {
		return err
	}

	// Check exists
	exists, err := s.StudentExists(ctx, maHP, mssv)
	if err != nil {
		return err
	}
	if exists {
		return fmt.Errorf("B·∫£n ghi ƒë√£ t·ªìn t·∫°i: (%s, %s)", maHP, mssv)
	}

	rec := Student{MaHP: maHP, MSSV: mssv, HoTen: hoTen, DiemHP: diem}
	data, err := json.Marshal(rec)
	if err != nil {
		return err
	}

	if err := ctx.GetStub().PutState(key, data); err != nil {
		return err
	}

	// Ph√°t event ƒë·ªÉ client b·∫Øt v√† t·ª± ghi file/ghi log
	if err := ctx.GetStub().SetEvent("StudentAdded", data); err != nil {
		return err
	}
	return nil
}

// L·∫•y b·∫£n ghi theo MaHP + MSSV
func (s *SmartContract) GetStudent(ctx contractapi.TransactionContextInterface, maHP, mssv string) (*Student, error) {
	key, err := makeKey(ctx, maHP, mssv)
	if err != nil {
		return nil, err
	}
	data, err := ctx.GetStub().GetState(key)
	if err != nil {
		return nil, fmt.Errorf("L·ªói GetState: %w", err)
	}
	if data == nil {
		return nil, fmt.Errorf("Kh√¥ng t√¨m th·∫•y b·∫£n ghi: (%s, %s)", maHP, mssv)
	}
	var rec Student
	if err := json.Unmarshal(data, &rec); err != nil {
		return nil, err
	}
	return &rec, nil
}

// C·∫≠p nh·∫≠t ƒëi·ªÉm
func (s *SmartContract) UpdateStudent(ctx contractapi.TransactionContextInterface, maHP, mssv string, diemMoi float64) error {
	if diemMoi < 0 || diemMoi > 10 {
		return fmt.Errorf("ƒêi·ªÉm kh√¥ng h·ª£p l·ªá (0‚Äì10)")
	}

	rec, err := s.GetStudent(ctx, maHP, mssv)
	if err != nil {
		return err
	}
	rec.DiemHP = diemMoi

	key, err := makeKey(ctx, maHP, mssv)
	if err != nil {
		return err
	}
	data, err := json.Marshal(rec)
	if err != nil {
		return err
	}

	if err := ctx.GetStub().PutState(key, data); err != nil {
		return err
	}
	if err := ctx.GetStub().SetEvent("StudentUpdated", data); err != nil {
		return err
	}
	return nil
}

// X√≥a b·∫£n ghi
func (s *SmartContract) DeleteStudent(ctx contractapi.TransactionContextInterface, maHP, mssv string) error {
	key, err := makeKey(ctx, maHP, mssv)
	if err != nil {
		return err
	}
	exists, err := s.StudentExists(ctx, maHP, mssv)
	if err != nil {
		return err
	}
	if !exists {
		return fmt.Errorf("Kh√¥ng t·ªìn t·∫°i ƒë·ªÉ x√≥a: (%s, %s)", maHP, mssv)
	}
	if err := ctx.GetStub().DelState(key); err != nil {
		return err
	}
	if err := ctx.GetStub().SetEvent("StudentDeleted", []byte(fmt.Sprintf("%s|%s", maHP, mssv))); err != nil {
		return err
	}
	return nil
}

// Ki·ªÉm tra t·ªìn t·∫°i
func (s *SmartContract) StudentExists(ctx contractapi.TransactionContextInterface, maHP, mssv string) (bool, error) {
	key, err := makeKey(ctx, maHP, mssv)
	if err != nil {
		return false, err
	}
	data, err := ctx.GetStub().GetState(key)
	if err != nil {
		return false, err
	}
	return data != nil, nil
}

// ----------------- Init -----------------

// Kh·ªüi t·∫°o d·ªØ li·ªáu m·∫´u
func (s *SmartContract) InitLedger(ctx contractapi.TransactionContextInterface) error {
	return s.AddStudent(ctx, "TH1383", "22022009", "Vo Hoai Sang", 8.5)
}

// ----------------- main -----------------

func main() {
	cc, err := contractapi.NewChaincode(new(SmartContract))
	if err != nil {
		fmt.Println("L·ªói t·∫°o chaincode:", err)
		return
	}
	if err := cc.Start(); err != nil {
		fmt.Println("L·ªói kh·ªüi ƒë·ªông chaincode:", err)
	}
}
‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶..
# Add th√¥ng tin sinh vi√™n
peer chaincode invoke \
  -o 127.0.0.1:7050 \
  --ordererTLSHostnameOverride orderer.example.com \
  --tls \
  --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
  -C mychannel \
  -n mychaincode \
  --peerAddresses localhost:7051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
  --peerAddresses localhost:9051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
 -c '{"Args":["AddStudent","TH1383","22022009","Vo Hoai Sang","8.5"]}'

#Update
peer chaincode invoke \
  -o 127.0.0.1:7050 \
  --ordererTLSHostnameOverride orderer.example.com \
  --tls \
  --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
  -C mychannel \
  -n mychaincode \
  --peerAddresses localhost:7051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
  --peerAddresses localhost:9051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
  -c '{"Args":["UpdateStudent","TH1383","22022009","9.0"]}'

# Truy xu·∫•t th√¥ng tin
peer chaincode query -C mychannel -n mychaincode -c '{"Args":["GetStudent","TH1383","22022009"]}'
#Delect
peer chaincode invoke \
  -o 127.0.0.1:7050 \
  --ordererTLSHostnameOverride orderer.example.com \
  --tls \
  --cafile /home/ubuntu/fabric-samples/test-network/organizations/ordererOrganizations/example.com/msp/tlscacerts/tlsca.example.com-cert.pem \
  -C mychannel \
  -n mychaincode \
  --peerAddresses localhost:7051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt \
  --peerAddresses localhost:9051 \
  --tlsRootCertFiles /home/ubuntu/fabric-samples/test-network/organizations/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt \
   -c '{"Args":["DeleteStudent","TH1383","22022009"]}'

C√†i ƒë·∫∑t HARDHAT
1.	C√†i ƒë·∫∑t Google Chrom
wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
sudo apt install ./google-chrome-stable_current_amd64.deb
2.	C√†i ƒë·∫∑t ganache
B∆∞·ªõc 1. C√†i c√°c th∆∞ vi·ªán c·∫ßn cho AppImage:
sudo apt install -y libfuse2 wget
B∆∞·ªõc 2. V√†o Ganache release tr√™n GitHub ‚Üí t·∫£i file .AppImage m·ªõi nh·∫•t, v√≠ d·ª• 2.7.1:
wget https://github.com/trufflesuite/ganache-ui/releases/download/v2.7.1/ganache-2.7.1-linux-x86_64.AppImage
B∆∞·ªõc 3: C·∫•p quy·ªÅn ch·∫°y & kh·ªüi ƒë·ªông
chmod +x ganache-2.7.1-linux-x86_64.AppImage
./ganache-2.7.1-linux-x86_64.AppImage
sudo mv ganache-2.7.1-linux-x86_64.AppImage /usr/local/bin/ganache
ganache
3.	C√†i ƒë·∫∑t Metamask
M·ªü Chrome ‚Üí v√†o MetaMask tr√™n Chrome Web Store.



4.	C√†i ƒë·∫∑t Hardhat
Khi c√†i xong ƒë·∫£m b·∫£o c√≥ hardhat.config.js, contracts/Voting.sol, contracts/deployVoting.js
X√≥a Node.js 18 ho·∫∑c 20:
sudo rm /etc/apt/sources.list.d/nodesource.list
C√†i ƒë·∫∑t node 22:
sudo apt install -y curl 
curl -fsSL https://deb.nodesource.com/setup_22.x | sudo -E bash -
sudo apt install -y nodejs

1.	C√†i ƒë·∫∑t h·ªá th·ªëng qu·∫£n l√Ω phi√™n b·∫£n
sudo apt install git -y
2.	T·∫°o nhanh file package.json m·∫∑c ƒë·ªãnh cho m·ªôt d·ª± √°n Node.j
npx npm init -y
npm install -g npm
3.	C√†i Hardhat v√†o d·ª± √°n hi·ªán t·∫°i, v√† l∆∞u v√†o m·ª•c ph√°t tri·ªÉn (devDependencies) trong package.json.
npx npm install --save-dev hardhat
T·∫°o d·ª± √°n Hardhat
npx hardhat --init
npm install --save-dev @nomicfoundation/hardhat-toolbox-viem
sudo nano hardhat.config.js
require("@nomicfoundation/hardhat-toolbox");

module.exports = {
  solidity: "0.8.28",
  networks: {
    ganache: {
      url: "http://127.0.0.1:7545", // URL Ganache
      accounts: [
        "0x6fad1c814342a4922076730e44df7da53be606b208821a6a49cd8609739901c0"
      ], // Private key c·ªßa account Ganache
    },
  },
};



sudo nano contracts/Voting.sol
‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶.
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.28;

contract Voting {
    string[] public candidatesList;
    mapping(string => uint) public votesReceived;
    mapping(address => bool) public hasVoted; // ‚úÖ L∆∞u tr·∫°ng th√°i ƒë√£ b·ªè phi·∫øu

    address public manager;

    constructor(string[] memory candidatesName) {
        manager = msg.sender;
        candidatesList = candidatesName;
    }

    // ‚úÖ Ki·ªÉm tra ·ª©ng vi√™n h·ª£p l·ªá
    function validCandidate(string memory candidate) public view returns (bool) {
        for (uint i = 0; i < candidatesList.length; i++) {
            if (
                keccak256(abi.encodePacked(candidate)) ==
                keccak256(abi.encodePacked(candidatesList[i]))
            ) {
                return true;
            }
        }
        return false;
    }

    // ‚úÖ B·ªè phi·∫øu - ch·ªâ ƒë∆∞·ª£c 1 l·∫ßn
    function voteCandidate(string memory candidate) public {
        require(validCandidate(candidate), "Ung vien khong hop le");
        require(!hasVoted[msg.sender], "Ban da bo phieu roi!"); // ‚úÖ Ch·∫∑n vote l·∫°i

        votesReceived[candidate]++;   // TƒÉng phi·∫øu cho ·ª©ng vi√™n
        hasVoted[msg.sender] = true;  // ƒê√°nh d·∫•u ƒë√£ b·ªè phi·∫øu
    }

    // ‚úÖ L·∫•y danh s√°ch t·∫•t c·∫£ ·ª©ng vi√™n
    function getAllCandidates() public view returns (string[] memory) {
        return candidatesList;
    }

    // ‚úÖ L·∫•y t·ªïng phi·∫øu c·ªßa m·ªôt ·ª©ng vi√™n (optional)
    function getVotes(string memory candidate) public view returns (uint) {
        return votesReceived[candidate];
    }
}
‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶
sudo nano scripts/deployVoting.js
async function main() {
    const Voting = await ethers.getContractFactory("Voting");
    const voting = await Voting.deploy(["Vo Hoai Sang", "Bui Thanh Kien", "Nguyen Anh Xuan"]);
    await voting.waitForDeployment();

    console.log("Dia Chi Voting:", voting.target);
}

main()
    .then(() => process.exit(0))
    .catch((error) => {
        console.log(error);
        process.exit(1);
})
npx hardhat run scripts/deployVoting.js --network ganache
Hi·ªÉn th·ªã l√™n web:
mkdir web
cd web
#t·∫£i g√≥i http-server
sudo npm install -g http-server
# t·∫°o file index.html
sudo nano index.html


index.html
‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Voting DApp</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  background-attachment: fixed;
  color: #fff;
  text-align: center;
  overflow-x: hidden;
  margin: 0;
  padding: 0;
  animation: bgMove 15s ease-in-out infinite alternate;
}
@keyframes bgMove {
  from { background-position: 0 0; }
  to { background-position: 100% 100%; }
}
h1 {
  color: #00e0ff;
  margin-top: 20px;
  text-shadow: 0 0 10px #00e0ff;
}
#account {
  margin-bottom: 5px;
  color: #aaa;
}
#status {
  margin-bottom: 20px;
  font-style: italic;
  color: #0ff;
  min-height: 20px;
}
#candidates {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 25px;
  margin: 20px auto;
  padding: 0 10px;
  max-width: 1000px;
}
.card {
  background: rgba(20, 20, 20, 0.9);
  border: 1px solid rgba(0,255,255,0.2);
  border-radius: 14px;
  padding: 15px;
  width: 230px;
  box-shadow: 0 0 15px rgba(0,255,255,0.15);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}
.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 0 25px rgba(0,255,255,0.4);
}
.card img {
  width: 100%;
  height: 150px;
  border-radius: 10px;
  object-fit: cover;
  margin-bottom: 10px;
  border: 1px solid rgba(0,255,255,0.2);
}
button {
  padding: 8px 14px;
  border: none;
  background: #00e0ff;
  color: #000;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
  transition: all 0.2s ease;
}
button:hover {
  transform: scale(1.08);
  background: #04f3ff;
}
canvas {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 9999;
}
</style>
</head>
<body>
<h1>Danh s√°ch ·ª©ng vi√™n</h1>
<div id="account"></div>
<div id="status"></div>
<div id="candidates"></div>
<canvas id="fireworks"></canvas>

<script src="https://cdn.jsdelivr.net/npm/ethers@6.15.0/dist/ethers.umd.min.js"></script>
<script>
(async function() {
  if (!window.ethereum) return alert("C·∫ßn MetaMask ho·∫∑c provider t∆∞∆°ng th√≠ch!");
  await window.ethereum.request({ method: "eth_requestAccounts" });

  const provider = new ethers.BrowserProvider(window.ethereum);
  const signer = await provider.getSigner();
  const account = await signer.getAddress();
  document.getElementById("account").innerText = "üë§ T√†i kho·∫£n: " + account;

  const statusEl = document.getElementById("status");

  const contractAddress = "0x7925976D89260E4E564CeE54A2843DBEB7BA7088";
  const contractABI = [
    { "inputs": [{ "internalType": "string[]", "name": "candidatesName", "type": "string[]" }], "stateMutability": "nonpayable", "type": "constructor" },
    { "inputs": [], "name": "getAllCandidates", "outputs": [{ "internalType": "string[]", "name": "", "type": "string[]" }], "stateMutability": "view", "type": "function" },
    { "inputs": [{ "internalType": "string", "name": "candidate", "type": "string" }], "name": "voteCandidate", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
    { "inputs": [{ "internalType": "string", "name": "candidate", "type": "string" }], "name": "votesReceived", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" }
  ];

  const contract = new ethers.Contract(contractAddress, contractABI, signer);
  const candidates = await contract.getAllCandidates();
  const container = document.getElementById("candidates");

  // üßë‚Äçüíª ·∫¢nh ƒë·∫°i di·ªán ri√™ng
  const candidateImages = {
    "Vo Hoai Sang": "image/1.jpg",
    "Bui Thanh Kien": "image/2.jpg",
    "Nguyen Anh Xuan": "image/3.jpg"
  };

  async function renderCandidates() {
    container.innerHTML = "";
    for (const name of candidates) {
      const votes = await contract.votesReceived(name);
      const card = document.createElement("div");
      card.className = "card";

      const img = document.createElement("img");
      img.src = candidateImages[name] || "https://i.imgur.com/8Z7gZME.jpg";

      const title = document.createElement("h3");
      title.innerText = name;

      const p = document.createElement("p");
      p.innerText = "Votes: " + votes;

      const btn = document.createElement("button");
      btn.innerText = "Vote";
      btn.onclick = async () => {
        try {
          const tx = await contract.voteCandidate(name);
          await tx.wait();
          statusEl.innerHTML = `‚úÖ B·∫°n ƒë√£ b·ªè phi·∫øu cho <b>${name}</b> th√†nh c√¥ng!`;
          showFireworks(async () => {
            const newVotes = await contract.votesReceived(name);
            p.innerText = "Votes: " + newVotes;
          });
        } catch (err) {
          const msg = err.info?.error?.message || err.message;
          if (msg.includes("revert")) {
            statusEl.innerHTML = `‚ö†Ô∏è B·∫°n ƒë√£ b·ªè phi·∫øu r·ªìi!`;
          } else {
            alert("L·ªói khi b·ªè phi·∫øu: " + msg);
          }
        }
      };

      card.append(img, title, p, btn);
      container.appendChild(card);
    }
  }

  await renderCandidates();

  // üéÜ Ph√°o hoa c√¥ng ngh·ªá
  const canvas = document.getElementById("fireworks");
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  function launchBurst(cx, cy, delay = 0) {
    return new Promise(resolve => {
      setTimeout(() => {
        const particles = [];
        for (let i = 0; i < 120; i++) {
          particles.push({
            x: cx,
            y: cy,
            vx: (Math.random() - 0.5) * 12,
            vy: (Math.random() - 0.5) * 12,
            size: Math.random() * 3 + 1,
            alpha: 1,
            color: `hsl(${Math.random() * 360}, 100%, 60%)`
          });
        }

        let frame = 0;
        const animate = () => {
          frame++;
          ctx.fillStyle = "rgba(0,0,0,0.15)";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          particles.forEach(p => {
            p.x += p.vx;
            p.y += p.vy;
            p.alpha -= 0.005;
            p.size *= 0.97;
            ctx.globalAlpha = p.alpha;
            ctx.fillStyle = p.color;
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
            ctx.fill();
          });
          if (frame < 100) requestAnimationFrame(animate);
          else resolve();
        };
        animate();
      }, delay);
    });
  }

  async function showFireworks(onFinish) {
    const cx = canvas.width / 2;
    const cy = canvas.height / 2 + 100;
    await launchBurst(cx, cy, 0);
    await launchBurst(cx - 150, cy - 80, 100);
    await launchBurst(cx + 150, cy - 100, 100);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    if (onFinish) onFinish();
  }
})();
</script>
</body>
</html>
‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶‚Ä¶..
http-server -p 8080 --host 0.0.0.0 . 







